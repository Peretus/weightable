<% require "date" %>

<script src="Chart.js"></script>

<div class="row">
  <div class="col-lg-4">
    <% if @user.profile_pic_url %>
      <img class="profile-pic clearfix" src=<%= @user.profile_pic_url(:sq_medium) %> />
    <% else %>
      <div class="no-image-wrapper">
        <%= form_for(@user) do |f| %>
          <% if @user.errors.any? %>
            <div id="error_explanation">
              <h2><%= pluralize(@user.errors.count, "error") %> prohibited this user from being saved:</h2>

              <ul>
              <% @user.errors.full_messages.each do |msg| %>
                <li><%= msg %></li>
              <% end %>
              </ul>
            </div>
          <% end %>


            <div class="field">

              <%= f.label :profile_pic %><br>
              <%= f.file_field :profile_pic, :required => true %><br><br>

            </div>
            <div class="actions">
              <%= f.submit %>
            </div>
          <% end %>
        <% end %>
      </div>
      <div class="col-4 col-sm-4 col-md-4 col-lg-6 about-me"> 
      <strong>Name:</strong>
      <%= @user.name %> <br>
   		<span><%= @user.weigh_ins.size %> Weigh-Ins |</span> 
      <span class="spacing"><%= @user.friends.size %> Fat Friends</span> <br>
      <p>goal <%= @user.goal %> lbs</p>
      <%= link_to 'Edit', edit_user_path(@user) %> |
      <%= link_to 'Back', users_path %>

      <% if @user.weigh_ins.first.created_at + 24*60*60 > Time.now %>
        <%= button_to "Update Today's WeighIn", edit_user_weigh_in_path(@user, :id => @user.weigh_ins.last.id), method: :get%> 
      <% else %>
        <div id="createWeighIn" >
          <h1>Post a weigh-in</h1>
            <p>
              <%= form_for [@user, @weigh_in] do |f| %>
                <%= f.label :weight %>
                <%= f.text_field :weight %><br />

                <%= f.label :status%>
                <%= f.text_field :status %><br />

                <%= f.submit "Weigh In!" %>
              <% end %>
            </p>
        </div>
      <%end%>
    </div>
    <div class="col-lg-1"> 
    </div>
  </div>
</div>


<!-- END OF ROW 1 -->
<div class="row">
  <div class="col-10 col-xs-10 col-sm-10 col-md-10 col-lg-10">
    <div class="progress-container">
      <div id="progressbar">
      </div>
        <p id="progress-label"><%=@progress%>% to goal! </p>
    </div>
  </div>
  <div class="col-2 col-xs-2 col-sm-2 col-lg-2">
    <p><%= @user.goal %> lbs</p>
    <p><%= @user.goal_date %></p>
  </div>
</div>

<!-- END OF ROW 2 -->

<div class="row">
  <div class="col-7 col-sm-7 col-lg-7">
    <div class="row">
      <div class="col-xs-12">
        <h1>your stats</h1>
        <canvas id="myChart" width="400" height="400"></canvas>

        <% if @user.weigh_ins.first.created_at + 24*60*60 > Time.now %>
          <%= button_to "Update Today's WeighIn", edit_user_weigh_in_path(@user, :id => @user.weigh_ins.last.id), method: :get%> 
        <% else %>
          <div id="createWeighIn" >
            <h1>Post a weigh-in</h1>
              <p>
                <%= form_for [@user, @weigh_in] do |f| %>
                  <%= f.label :weight %>
                  <%= f.text_field :weight %><br />

                  <%= f.label :status%>
                  <%= f.text_field :status %><br />

                  <%= f.submit "Weigh In!" %>
                <% end %>
              </p>
          </div>
        <%end%>
      </div>
    </div>


<!-- Displays user's BMI from users_controller and rounds to nearest two digit decimal place -->
    <div class="row">
      <div class="col-xs-12">
        <h1>Body Mass Index (BMI): <%= @bmi %></h1>
        <!-- The user's lowest weigh in -->
        <h1>Record Weight: <%= @record_weight %></h1>
        <!-- User's BMI description -->
        <h3> <%= @record_weight_status %></h3>
      </div>
    </div>
  </div>

<!-- Renders User timeline -->
  <div class="col-xs-8 col-xs-offset-2 col-sm-5 col-sm-offset-0 col-md-5">
    <div class="feed-timeline hidden-xs"></div>
      <%= render 'show_wi_feed' %>  
    </div>
  </div>
</div>


	<script type="text/javascript">
  

  $(function() {
	options = {
		// set to line chart instead of curve
		//Boolean - If we want to override with a hard coded scale
		scaleOverride : true,
		
		//** Required if scaleOverride is true **
		//Number - The number of steps in a hard coded scale
		scaleSteps : 5,
		//Number - The value jump in the hard coded scale
		scaleStepWidth : <%= (((@user.weigh_ins.first.weight+5)-(@user.goal-15))/5) %>,
		//Number - The scale starting value
		scaleStartValue : <%= @user.goal-2%>,
		
    pointDotRadius : 6,
    datasetStrokeWidth : 6,
    scaleFontFamily : 'Open Sans',
    scaleGridLineColor : "rgba(112,160,172,.5)",
		


	}

  	data = {
    labels :  <%=raw @dates.length > 7 ? @dates[-7,7] : @dates %>,
    datasets : [
       {
        strokeColor : "rgba(38,104,120,0)",
        pointColor : "rgba(38,104,120,0)",
        pointStrokeColor : "rgba(61,185,209,0)",
        fillColor : "rgba(75,177,199,0.7)",
        data : <%= @weights.length > 7 ? @weights[-7,7] : @weights %>
      },
  

       {
        strokeColor : "rgba(231,87,53,0)",
        pointColor : "rgba(51,51,51,0)",
        pointStrokeColor : "rgba(0,132,164,0)",
        fillColor : "rgba(105,207,144,0.8)",
        data : <%= @weights.length > 7 ? @goal[-7,7] : @goal %>
      },
   
       {
         strokeColor : "rgba(231,87,53,.9)",
         pointColor : "rgba(51,51,51,0)",
         pointStrokeColor : "rgba(0,132,164,0)",
         fillColor : "rgba(105,207,144,0)",
         data : <%= @weights.length > 7 ? @goal[-7,7] : @goal %>
       },

      {
        strokeColor : "rgba(38,104,120,.8)",
        pointColor : "rgba(38,104,120,1)",
        pointStrokeColor : "rgba(61,185,209,1)",
        fillColor : "rgba(75,177,199,0)",
        data : <%= @weights.length > 7 ? @weights[-7,7] : @weights %>
      }
    ]
  }

  myNewChart = new Chart($("#myChart").get(0).getContext("2d")).Line(data,options)
});</script>

<script>
$( "#progressbar" ).progressbar({
  value: <%=@progress%>
});
</script>
